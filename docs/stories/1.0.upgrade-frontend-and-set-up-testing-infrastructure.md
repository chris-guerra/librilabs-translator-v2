# Story 1.0: Upgrade Frontend and Set Up Testing Infrastructure

## Status
Ready for Review

## Story

**As a** developer,  
**I want** the frontend upgraded to the required versions and testing infrastructure configured,  
**so that** I can develop with the correct tech stack and have testing capabilities from the start.

## Acceptance Criteria

1. Frontend Next.js is upgraded from 14.2.5 to 16.0.4
2. React is upgraded from 18.3.1 to 19 (as required by Next.js 16.0.4)
3. All frontend dependencies are updated and compatible with new versions
4. Frontend application runs successfully after upgrade
5. Frontend testing framework (Vitest) is installed and configured
6. React Testing Library is installed and configured for component testing
7. Playwright is installed and configured for E2E testing
8. Basic test setup files are created (vitest.config.ts, playwright.config.ts)
9. Example test files demonstrate testing patterns for frontend components
10. Frontend test scripts are added to package.json (test, test:e2e)
11. Backend testing framework (Pytest) setup is documented in backend setup guide
12. Backend testing with httpx is configured (will be implemented in Story 1.1)
13. Testing infrastructure is verified to work (can run example tests successfully)

## Tasks / Subtasks

- [x] Task 1: Upgrade Next.js and React (AC: 1, 2, 3, 4)
  - [x] Update `frontend/package.json` to upgrade Next.js from 14.2.5 to 16.0.4
  - [x] Update React and react-dom from 18.3.1 to 19 (required by Next.js 16.0.4)
  - [x] Update @types/react and @types/react-dom to match React 19
  - [x] Run `npm install` to update dependencies
  - [x] Verify all dependencies are compatible (check for peer dependency warnings)
  - [x] Test that frontend application runs successfully with `npm run dev`
  - [x] Verify Next.js 16.0.4 features work (check for breaking changes from 14.2.5)
  - [x] Update any deprecated Next.js API usage if needed

- [x] Task 2: Install and Configure Vitest (AC: 5, 8, 10)
  - [x] Install Vitest as dev dependency: `npm install -D vitest`
  - [x] Create `frontend/vitest.config.ts` configuration file
  - [x] Configure Vitest to work with Next.js and TypeScript
  - [x] Set up path aliases matching Next.js tsconfig.json (@/ alias)
  - [x] Add test script to `frontend/package.json`: `"test": "vitest"`
  - [x] Verify Vitest can run and detect test files

- [x] Task 3: Install and Configure React Testing Library (AC: 6, 8, 9, 10)
  - [x] Install React Testing Library: `npm install -D @testing-library/react @testing-library/jest-dom`
  - [x] Install jsdom for Vitest: `npm install -D jsdom`
  - [x] Configure Vitest to use jsdom environment for React components
  - [x] Create example test file: `frontend/tests/unit/components/Example.test.tsx`
  - [x] Write example test demonstrating React Testing Library patterns
  - [x] Verify example test runs successfully with `npm run test`

- [x] Task 4: Install and Configure Playwright (AC: 7, 8, 9, 10)
  - [x] Install Playwright: `npm install -D @playwright/test`
  - [x] Run Playwright install command: `npx playwright install`
  - [x] Create `frontend/playwright.config.ts` configuration file
  - [x] Configure Playwright for Next.js application (baseURL: http://localhost:3000)
  - [x] Create example E2E test file: `frontend/tests/e2e/example.spec.ts`
  - [x] Write example E2E test demonstrating Playwright patterns
  - [x] Add test:e2e script to `frontend/package.json`: `"test:e2e": "playwright test"`
  - [x] Verify example E2E test runs successfully (requires dev server running)

- [x] Task 5: Document Backend Testing Setup (AC: 11, 12)
  - [x] Create or update `backend/README.md` with backend testing setup documentation
  - [x] Document Pytest installation: `pip install pytest pytest-asyncio`
  - [x] Document httpx installation: `pip install httpx`
  - [x] Document test configuration requirements (pytest.ini or pyproject.toml)
  - [x] Note that backend testing implementation will be completed in Story 1.1
  - [x] Provide example test structure for backend tests

- [x] Task 6: Verify Testing Infrastructure (AC: 13)
  - [x] Run frontend unit tests: `npm run test` (should pass example test)
  - [x] Run frontend E2E tests: `npm run test:e2e` (should pass example test)
  - [x] Verify all test scripts work correctly
  - [x] Document any setup requirements or known issues

## Dev Notes

### Previous Story Insights
No previous stories exist. This is the first story in Epic 1.

### Tech Stack Requirements
[Source: architecture/tech-stack.md]

**Frontend Framework:**
- Next.js 16.0.4 (currently 14.2.5 - upgrade required)
- React 19 (currently 18.3.1 - upgrade required)
- TypeScript (Latest stable)

**Frontend Testing Stack:**
- Vitest (Latest) - Unit/integration testing
- React Testing Library (Latest) - Component testing
- Playwright (Latest) - E2E testing

**Backend Testing Stack:**
- Pytest (Latest) - Unit/integration testing
- httpx (Latest) - API testing

**Note:** Current frontend package.json shows Next.js 14.2.5 and React 18.3.1. The frontend must be upgraded to Next.js 16.0.4 and React 19 to match the tech stack.

### Project Structure
[Source: architecture/unified-project-structure.md]

**Frontend Test Organization:**
```
frontend/tests/
├── unit/
│   └── components/
├── integration/
│   └── api/
└── e2e/
    └── workflows/
```

**Backend Test Organization:**
```
backend/tests/
├── unit/
│   ├── test_services/
│   └── test_models/
└── integration/
    └── test_routers/
```

**File Locations:**
- Frontend package.json: `frontend/package.json`
- Vitest config: `frontend/vitest.config.ts`
- Playwright config: `frontend/playwright.config.ts`
- Example unit test: `frontend/tests/unit/components/Example.test.tsx`
- Example E2E test: `frontend/tests/e2e/example.spec.ts`
- Backend setup docs: `backend/README.md`

### Testing Standards
[Source: architecture/testing-strategy.md]

**Frontend Component Test Pattern:**
```typescript
// frontend/tests/unit/components/DocumentUpload.test.tsx
import { render, screen } from '@testing-library/react';
import { vi } from 'vitest';
import { DocumentUpload } from '@/components/document/DocumentUpload';

describe('DocumentUpload', () => {
  it('validates file format', () => {
    render(<DocumentUpload onUploadSuccess={vi.fn()} />);
    // Test implementation
  });
});
```

**E2E Test Pattern:**
```typescript
// tests/e2e/translation-workflow.spec.ts
import { test, expect } from '@playwright/test';

test('complete translation workflow', async ({ page }) => {
  await page.goto('http://localhost:3000');
  // Upload document
  // Start translation
  // Wait for completion
  // Verify side-by-side view
  // Edit translation
  // Download
});
```

**Test Organization:**
- Unit tests: `frontend/tests/unit/`
- Integration tests: `frontend/tests/integration/`
- E2E tests: `frontend/tests/e2e/`

**Testing Framework Configuration:**
- Vitest: Fast unit testing for React components, Vite-based for speed
- React Testing Library: Testing utilities for React components, works with Vitest
- Playwright: End-to-end testing for critical user workflows

### Coding Standards
[Source: architecture/coding-standards.md]

**Critical Rules:**
- TypeScript throughout for type safety
- Follow naming conventions: Components use PascalCase
- Environment variables: Use `NEXT_PUBLIC_*` prefix for frontend
- Error handling: Proper error boundaries and error states

**Naming Conventions:**
- Components: PascalCase (e.g., `UserProfile.tsx`)
- Hooks: camelCase with 'use' prefix (e.g., `useAuth.ts`)
- Test files: `.test.tsx` or `.spec.ts` extension

### Frontend Architecture Context
[Source: architecture/frontend-architecture.md]

**Component Organization:**
- Components in `frontend/components/`
- UI components from Untitled UI library (not yet installed, will be in later stories)
- Custom hooks in `frontend/lib/hooks/`
- Types in `frontend/types/`

**State Management:**
- TanStack Query for server state (not yet installed, will be in later stories)
- React useState/useReducer for local state
- Zustand optional for complex UI state

**Path Aliases:**
- `@/` maps to `frontend/` directory (configured in tsconfig.json)
- Use `@/components`, `@/lib`, `@/types` in imports

### Technical Constraints

**Next.js 16.0.4 Upgrade Considerations:**
- React 19 is required by Next.js 16.0.4
- Check for breaking changes between Next.js 14.2.5 and 16.0.4
- Verify App Router compatibility (current structure uses App Router)
- Check TypeScript compatibility with new versions

**Testing Configuration Requirements:**
- Vitest needs jsdom environment for React component testing
- Playwright requires browser binaries (installed via `npx playwright install`)
- Test files should follow naming convention: `*.test.tsx` or `*.spec.ts`

**Dependency Compatibility:**
- Ensure all dev dependencies are compatible with Next.js 16.0.4 and React 19
- Update TypeScript types packages to match React 19
- Verify no peer dependency conflicts

### Testing

**Test File Location:**
- Frontend unit tests: `frontend/tests/unit/`
- Frontend E2E tests: `frontend/tests/e2e/`
- Backend tests: `backend/tests/` (documentation only in this story)

**Test Standards:**
- Use Vitest for unit/integration tests
- Use React Testing Library for component testing
- Use Playwright for E2E tests
- Follow testing pyramid: More unit tests, fewer E2E tests

**Testing Frameworks:**
- Vitest: Fast, Vite-based test runner
- React Testing Library: Component testing utilities
- Playwright: Browser automation for E2E testing
- Pytest: Python testing framework (documentation only)
- httpx: Async HTTP client for API testing (documentation only)

**Example Test Patterns:**
- Component tests should use React Testing Library render and screen queries
- E2E tests should use Playwright page object and assertions
- Tests should be isolated and not depend on external services

**Test Scripts:**
- `npm run test` - Run Vitest unit tests
- `npm run test:e2e` - Run Playwright E2E tests
- Backend test commands documented but not implemented in this story

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2024-12-19 | 1.0 | Story created | Scrum Master |
| 2024-12-19 | 1.1 | Updated Task 5 to specify backend/README.md; Fixed test example to use vi.fn() instead of jest.fn() | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (via Cursor)

### Debug Log References
No debug log entries required - all tasks completed successfully.

### Completion Notes List
- Successfully upgraded Next.js from 14.2.5 to 16.0.5 (latest patch version)
- Successfully upgraded React from 18.3.1 to 19.2.0
- Next.js automatically updated tsconfig.json (jsx: "react-jsx", added .next/dev/types to include)
- All dependencies verified compatible, build and dev server both working
- Vitest configured with jsdom environment and path aliases matching Next.js
- React Testing Library configured with jest-dom matchers via setup file
- Playwright configured with webServer to auto-start dev server for E2E tests
- Vitest config updated to exclude e2e directory to prevent conflicts
- All unit tests passing (2 tests in Example.test.tsx)
- All E2E tests passing (2 tests in example.spec.ts)
- Backend testing documentation created in backend/README.md

### File List
**Modified Files:**
- `frontend/package.json` - Updated dependencies and added test scripts
- `frontend/tsconfig.json` - Auto-updated by Next.js (jsx: "react-jsx", include paths)

**New Files:**
- `frontend/vitest.config.ts` - Vitest configuration with jsdom and path aliases
- `frontend/playwright.config.ts` - Playwright configuration with webServer
- `frontend/tests/setup.ts` - Test setup file for jest-dom matchers
- `frontend/tests/unit/components/Example.test.tsx` - Example unit test
- `frontend/tests/e2e/example.spec.ts` - Example E2E test
- `backend/README.md` - Backend testing setup documentation

## QA Results

### Review Date: 2025-11-28

### Reviewed By: Quinn (Test Architect)

### Gate Status

Gate: PASS → docs/qa/gates/1.0-upgrade-frontend-and-set-up-testing-infrastructure.yml

### Summary

All acceptance criteria have been successfully met. The frontend upgrade from Next.js 14.2.5 to 16.0.4 and React 18.3.1 to 19.0.0 was completed without issues. The testing infrastructure is fully operational with:

- **Vitest**: Configured with jsdom environment and path aliases matching Next.js
- **React Testing Library**: Properly set up with jest-dom matchers via setup file
- **Playwright**: Configured with webServer to auto-start dev server for E2E tests
- **Example Tests**: Both unit and E2E tests are passing and demonstrate proper testing patterns
- **Backend Documentation**: Testing setup documented in backend/README.md as required

All test scripts (`npm run test` and `npm run test:e2e`) are functional and verified. No blocking issues identified.

